#!/bin/bash

# Pastikan package dialog terinstall
if ! command -v dialog &> /dev/null; then
    echo "Package 'dialog' belum terinstall. Install dulu dengan: apt install dialog"
    exit
fi

clear
HEIGHT=30
WIDTH=80
CHOICE_HEIGHT=4
BACKTITLE="Timezone Fixer by Gemini"
TITLE="FIX WAKTU KURANG SESUAI"
MENU="Pilih zona waktu untuk Linux kamu. Pastikan Linux ditutup dulu sebelum eksekusi.\n\nWIB: Sumatra, Jawa, Madura, dkk\nWITA: Bali, NTT, Sulawesi, dkk\nWIT: Papua, Maluku"

OPTIONS=(
1 "Set WIB (Jakarta)"
2 "Set WITA (Makassar)"
3 "Set WIT (Jayapura)"
4 "Set Brunei")

CHOICE=$(dialog --clear \
                --backtitle "$BACKTITLE" \
                --title "$TITLE" \
                --menu "$MENU" \
                $HEIGHT $WIDTH $CHOICE_HEIGHT \
                "${OPTIONS[@]}" \
                2>&1 >/dev/tty)

clear

# Fungsi bantu untuk eksekusi perintah proot
run_timezone() {
    # Menggunakan sudo jika user2 bukan root, hilangkan sudo jika tidak perlu
    proot-distro login ubuntu --user user2 --shared-tmp -- bash -c "ln -sf /usr/share/zoneinfo/Asia/$1 /etc/localtime"
}

case $CHOICE in
    1) run_timezone "Jakarta" ;;
    2) run_timezone "Makassar" ;;
    3) run_timezone "Jayapura" ;;
    4) 
        # Perbaikan kutip untuk Brunei
        proot-distro login ubuntu --user user2 --shared-tmp -- bash -c "ln -sf /usr/share/zoneinfo/Asia/Brunei /etc/localtime"
        ;;
    *) exit ;; # Keluar jika menekan Cancel atau tombol lain
esac

echo -e "\n\033[32mSelesai! Jam akan menyesuaikan setelah kamu membuka kembali Linux.\033[0m\n"
